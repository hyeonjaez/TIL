## 아이템 76 - 가능한 한 실패 원자적으로 만들라

- 작업이 실패하더라도 객체의 상태는 변경되지 않아야 한다
- 실패가 발생하더라도 객체가 일관된 상태를 유지해야 한다
- 이것을 실패 원자성이라고 한다

**실패 원자성의 중요성**
- 실패한 연산이 객체의 내부 상태를 망가뜨리면 이후 동작이 비정상적으로 변하거나 디버깅이 어려워진다
- 반대로 실패 원자성을 지키면 예외 이후에도 객체를 계속 안전하게 사용할수 있다


<br/>

**실패 원자성을 지키는 방법**
1. 불변 객체로 설계
- 불변 객체는 상태가 절대 변하지 않아서 실패 원자성을 자연스럽게 만족한다
- 어떤 연산을 하더라도 새로운 객체를 반환하기 때문에 기존 객체는 영향을 받지 않는다

2. 작업 수행전 유효성 검증
- 인자 검증을 먼저 수행해서 실패 가능성을 조기에 차단한다

3. 임시 변수 사용
- 변경 작업을 바로 필드에 적용하지 말고
- 임시 변수에 계산 결과를 저장한뒤 성공하면 반영한다

4. 복구 코드 작성
- 작업 중 실패했을 경우 원래 상태로 되돌리는 코드를 명시적으로 작성

**만약 객체 일관성 유지가 불가능하다면**
- 실패 원자성을 지키기 어려운 경우에는 예외 발생 시 객체가 더 이상 사용될수 없음을 문서화해야한다


**일반적인 실수**
- 상태를 변경하면서 예외를 던지는 코드
- 입력 검증 없이 바로 필드 값을 변경하는 코드
- 여러 단계를 수행하는 메서드에서 중간 실패를 고려하지 않은 설계

<br/>

**나의 정리**
- 실패 원자성은 실패해도 객체 상태가 변하지 않는 성질이다
- 불변객체를 설계하거나 작업 전 검증, 임시 변수 사용으로 상태 변경을 지연 시키는 것이 방법이다
- 실패 원자성을 지키면 코드의 신뢰성, 복구, 유지보수성이 향상된다

