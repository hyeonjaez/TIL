## 아이템 83 - 지연 초기화는 신중히 사용하라

**지연 초기화**
- 필요할 때까지 객체의 초기화를 미루는 기법


<br/>

**언제 지연 초기화를 쓸까**
- 지연 초기화는 필드 초기화 비용이 크고 그 필드가 실제로 쓰이지 않을 가능성이 있을때만 사용하자
- 객체 생성 시점의 비용이 너무 큰 경우
- 일부 필드가 실제로 사용되지 않을수도 있는 겨우


<br/>

**지연 초기화와 스레드 안전성 문제**
- 멀티 스레드 환경에서 단순한 lazy initialization 코드는 위험하다
- 여러 스레드가 동시에 접근하면 여러번 호출될수 있고 잘못된 상태의 객체가 만들어질수도 있다

<br/>

**해결책 - synchronized**
- 가장 단순하고 안전한 방법은 synchronized 키워드를 사용하는 것이다
- 완전한 스레드 안전성 확보하지만 필드에 자주 접근하면 동기화 비용이 누적될수 있다


**해결책 - 이중검사**
- 이중 검사는 올바르게 구현하기 까다롭지만 잘쓰면 성능이 좋다

- volatile을 사용해야 올바르게 작동한다
- field가 이미 초기화되었다면 동기화 없이 반환
- 아직 초기화되지 않았다면 단 한번ㄴ만 초기화 된다
- 잘못 구현하면 위험하지만 volatile을 사용하면 올바르고 빠르게 작동한다

**해결책 - 지연 초기화 홀더 클래스**
- 클래스가 처음 로딩될때 JVM이 클래스 초기화를 보장해서 완전한 스레드 안정성 확보한다
- synchronized 불필요
- static 필드에만 적용가능하다
- 이 방식은 클래스 로더의 초기화 순서를 이용해서 동기화난 volatile 없어도 안전하다

**해결책 - 단일 검사**
- 멀티스레드가 아닌 경우에서 사용가능하다


<br/>

**책에서 말하고자 하는 것**
- 지연 초기화는 성능을 개선할 수 있지만 불필요한 복잡성을 야기할 가능성이 크다
- 대부분의 필드는 즉시 초기화하는것이 좋다
- 꼭 필요하다면 상황에 맞는 지연 초기화 관용구를 신중히 선택하자



