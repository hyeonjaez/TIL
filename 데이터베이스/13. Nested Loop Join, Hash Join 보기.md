## 13. Nested Loop Join, Hash Join 보기

### 🧠 개념 설명

**Nested Loop Join**
- Join시에 바깥 테이블의 행 하나씩을 가져와서 안쪽 테이블에서 조건에 맞는 행을 찾는다
- 이중 반복문 구조이다.

- 특징
  - 작은 테이블과 큰 테이블을 조인할때 유리하다
  - Inner table이 인덱스를 가지고 있다면 성능이 빠르게 개선된다
  - 하지만 양쪽 테이블 모두 크면 비효율적
 
**Hash Join**
- 한쪽 테이블을 기반으로 해시 테이블 생성 -> 보통 작은쪽
- 다른 테이블을 스캔하면서 동일한 키값이 해시 테이블에 있는지 확인

- 특징
  - 대규모 테이블 조인에서 성능이 좋다
  - 범위 조건보다는 동등 조인에 적합하다
  - 인덱스가 없어도 빠르게 동작한다
  - 메모리 사용량이 크고 해시 충돌시에 성능이 저하될수 있다


**MySQL**
- MySQL InnoDB는 전통적으로 Nested Loop Join 기반
- Hash Join은 MySQL 8.0.18 부터 옵티마이저에서 지원한다 -> 동등 조인 상황에서만
  - 옵티마이저가 통계와 비용에 따라서 둘중에 선택한다
  - 실행 계획 확인 -> EXPLAIN 결과에서 HASH JOIN으로 표시된다
 
<br/>

**왜 작은쪽 테이블을 해시 테이블로 생성하냐**
- 만약 큰 테이블을 해시 테이블로 만들면 -> 큰 만큼의 메모리를 써서 메모리 부족이 일어남
- Hash Join의 복잡도는 Build단계 + Probe 단계
  - Build : 해시 테이블 만드는 작업
  - Probe : 다른 테이블 순회하며 검색
  - Build 비용 -> 해시 테이블 구성 비용은 작은 테이블 일수록 유리하다

**캐시 로컬리티 관점에서는**
- 작은 테이블이면 해시 테이블 자체가 캐시처럼 -> 탐색 속도가 빨라진다
- 반대로 큰 테이블을 해시 테이블로 만들면 캐시 미스가 많아져서 성능저하가 일어난다

다시 말해서 Hash Join에서 작은 쪽 테이블을 해시 테이블로 만드는 이유는 메모리 사용량 절감, 빌드 미용 최소화, 캐시 효율 향상 때문이다.
즉, 작은쪽을 Build, 큰쪽을 Probe 하는게 조인 성능을 최적화하는 일반적인 전략


---
### ✅ 한줄로 설명 하기

- Nested Loop Join은 작은 테이블 + 인덱스 기반 조인에 적합한 반복문 방식이다
- Hash Join은 작은 테이블을 해시 테이블로 만들어서 테이블 간에 동등 조인을 메모리 기반으로 빠르게 처리하는 방식이다
