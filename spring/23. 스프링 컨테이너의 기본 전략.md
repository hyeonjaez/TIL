## 23. 스프링 컨테이너의 기본 전략.md

### 🧠 개념 설명
- 스프링 컨테이너는 트랜잭션 범위의 영속성 컨텍스트 전략을 기본으로 사용한다
- 이름 그대로 트랜잭션 범위와 영속성 컨텍스트의 생존 범위가 같다는 뜻이다
- 같은 트랜잭션 안에서는 항상 같은 영속성 컨텍스트에 접근한다

**스프링 프레임워크에서는**
- 보통 비즈니스 로직을 Service 계층에 @Transactional 어노테이션을 선언해서 트랜잭션을 싲가한다
- 이 어노테이션은 스프링의 AOP로 구현이 되어 있고
- 이 어노테이션이 있으면 호출한 메소드를 실행하기 직전에 트랜잭션 AOP가 먼저 동작한다
- 그래서 메소드를 호출하기 전에 트랜잭션을 시작하고 메소드가 종료되면 트랜잭션을 커밋하면서 종료한다
- 트랜잭션을 커밋하면 JPA는 먼저 영속성 컨텍스트를 플러시해서 변경 내용을 데이터베이스에 반영한 후에 데이터베이스 트랜잭션을 커밋한다
- 하지만 예외가 발생하면 트랜잭션을 롤백하고 종료하고 플러시를 호출하지 않는다

<br/>

**트랜잭션 범위의 영속성 컨텍스트 전략**
- 이 전략은 다양한 위치의 엔티티 매니저를 주입받아 사용해도 트랜잭션이 같으면 항상 같은 영속성 컨텍스트를 사용한다
- 다시 말해서 엔티티 매니저가 달라도 같은 영속성 컨텍스트를 사용한다는 뜻이다

- 스프링 컨테이너는 스레드마다 각각 다른 트랜잭션을 할당한다
- 이말은 같은 엔티티 매니저를 호출해도 접근하는 영속성 컨텍스트가 다르므로 멀티 스레드 상황에 안전하다
- 이것이 스프링 컨테이너의 가장 큰 장점이다


---
### ✅ 한줄로 설명 하기
- 스프링 컨테이너는 트랜잭션 범위의 영속성 컨텍스트 전략을 사용하는데 트랜잭션 범위와 영속성 컨텍스트의 생존 범위가 같다는 뜻이다.
