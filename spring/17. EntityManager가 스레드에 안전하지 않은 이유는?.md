## 17. EntityManager가 스레드에 안전하지 않은 이유는?

### 🧠 개념 설명
**EntityManager**
- EntityManager는 JPA에서 자바 객체와 데이터 베이스 테이블을 연결해주는 것이다.
- EntityManager를 통해서 자바 객체를 DB에 저장, 조회, 수정, 삭제할 수 있다.

**EntityManager에는 뭐가 있을까?**
- 영속성 컨텍스트
- 변경 감지
- DB 연결 정보


**왜 스레드에 안전하지 않을까?**
- 여러 스레드가 같은 EntityManger를 동시에 쓰게된다면
  - 1차 캐시에 저장된 객체가 꼬일수 있다
  - 예를들어서 A스레드가 user.name을 수정했는데 B 스레드도 같은 시점에 DB를 조작하게 된다면 동기화가 꼬여서 잘못된 UPDATE가 발생한다
- 트랜잭션이 서로 섞여버려서 데이터 무결성이 깨진다
- 그래서 한 스레드 당 하나의 EntityManager만 사용하는게 원칙이다.


**데이터 무결성**
- 데이터가 정확하고 일관되며 신뢰할 수 있는 상태

---
### ✅ 한줄로 설명 하기
- EntityManger는 상태를 가진 객체라 여러 스레드가 동시에 접근하면 캐시와 트랜잭션이 꼬여서 데이터 무결성이 깨져 스레드 세이프 하지 않는다.
