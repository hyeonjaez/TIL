## 20. N+1 문제란?

### 🧠 개념 설명
- JPA에서 연관 관계가 지연 로딩으로 설정되어 있을 때 자주 발생하는 문제이다
- 엔티티를 조회할 때 쿼리를 날리고 (N)
- 그 후 연관된 엔티티들을 다시 조회해서 (+1) 총 N+1번의 쿼리가 실행되는 상황이다


```java
@Entity
public class Order {
  @ManyToOne(fetch = FetchType.LAZY)
  private User user;
}

조회 코드
List<Order> orderList = orderRepository.findAll();

for(Order order : orders){
  System.out.println(order.getUser().getId());
}

```
- 위 코드를 보면 orderList 를 조회한다고 했을때 1번이고 결과가 100건 이라고 하면
- 실제로 연관된 데이터를 사용할때 100번를 더 사용하게 된다
- 그래서 1 + N -> 1 + 100 의 쿼리가 나가게 된다.


**왜 문제일까?**
- 데이터가 많아질수록 쿼리가 늘어나게 된다
- 그래서 성능 저하가 발생한다

**해결 방법**
- 한번의 SQL로 가져오는 방법인 Fetch Join 방법을 사용
- @EntityGraph 어노테이션으로 fetch Join 효과를 볼수 있다
- @BatchSize로 Batch Size 조정한다 : Hibernate가 연관 엔티티들을 IN 절로 묶어서 조회한다

---
### ✅ 한줄로 설명 하기
- N+1 문제는 연관 엔티티를 지연 로딩할때 한 번 조회후 각 연관 엔티티마다 추가 쿼리가 실행되는 현상이다.
