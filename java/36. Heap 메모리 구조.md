## 36. Heap 메모리 구조

### 🧠 개념 설명
- Heap은 자바 애플리케이션 실행할때 JVM이 객체를 저장하는 주된 영역이다.
- GC가 관리한다
- 구조는 3가지로 나뉜다
  - Young Generation
  - Old Generation
  - Metaspace

<br/>

**Young Generation**

- 새로 생성된 객체들이 저장되는 영역
- Young Generation이 가득 차면 Minor GC가 발생한다
- 구성 요소
  - Eden Space
    - 모든 객체가 처음 생성되는 영역
   
  - Survivor Space
    - Eden에서 살아남은 객체가 이동하는 영역
    - 두개의 Survivor 영역이 번갈아 사용된다
    - Eden -> Survivor -> Old 로 가는 흐름
   
- 대부분의 객체는 이 영역에서 생성되고 GC로 빠르게 수거된다

<br/>

**Old Generation**
- Young Generation을 거쳐서 살아남은 수명이 긴 객체가 저장되는 영역
- 가득 차면 Major Gc가 발생한다
- 객체의 생명주기가 길수록 Old 영역에 존재할 확률이 높다

<br/>

**Metaspace -> 힙 영역 밖에 있다 (이전 버전인 Permanent Generation 은 힙 영역 안에 있었다)**
- 클래스 메타데이터(클래스 정보, 메서드, 상수풀)가 저장되는 영역이다
- Java 8 부터는 PermGen이 제거되고 Metaspace로 대체되었다
- PermGen 은 JVM 힙에 포함되었지만
- Metaspace는 Native Memory 힙 외부에 위치한다

**Metaspace가 힙 밖에 있으면 GC는 어떻게 관리 할까?**
- Metaspace는 Native Memory에 있지만 클래스 메타 데이터는 클래스 로더와 연결되어 있어 클래스 로더가 더이상 참조되지 않으면 해당 클래스 메타데이터도 GC 대상이된다
- 클래스 언로딩 과정을 통해 해제된다.
- 클래스 로더 : 클래스를 메모리로 불러오는 역할을 하는 객체

<br/>

---
### ✅ 한줄로 설명 하기
- 힙 메모리는 Young Generation, Old Generation 이 있고
- Young Generation은 새로 생성된 객체들이 저장되는 영역으로 Eden Space, Survivor Space 로 구성되어 있고
- Old Generation은 Young Generation을 거쳐서 살아남은 객체가 저장되는 영역이다
- 객체들은 Eden Space -> Survivor Space -> Old 로 가는 흐름이다
- Java 8 이전 버전에서는 Permanent Generation 이라고 지금은 Metaspace 가 있는데 클래스 메타데이터가 저장되는 영역이고
- Java 8 부터는 힙 영역 밖에 있다
